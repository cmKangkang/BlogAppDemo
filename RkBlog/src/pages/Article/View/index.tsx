import { Fragment } from 'react';
import { useArticle } from '../../../hooks';
import { useParams, useHistory, useRouteMatch } from 'react-router-dom';
import { Viewer } from '@bytemd/react';
import highlight from '@bytemd/plugin-highlight';
import gfm from '@bytemd/plugin-gfm';
import style from './style.module.less';
import moment from 'moment';
import { imagePreviewBaseUrl } from '../../../data';
import store from '../../../store';
import ToolBtn from '../../../components/ToolBtn';
import Footer from '../../../components/Footer';

const plugins = [highlight(), gfm()];

export default function ArticleViewer() {
  const params = useParams<{ id: string }>();
  const match = useRouteMatch({
    path: '/article/:id',
    strict: true,
  });
  const article = useArticle(params.id);
  const history = useHistory();
  const handleEdit = () => {
    history.push(`${match?.url}/edit`, {
      id: params.id,
    });
  };
  return (
    <Fragment>
      <div className={style.banners}>
        {/* 存放banner */}
        {article?.banner && article?.banner[0] && <img src={imagePreviewBaseUrl + article?.banner[0]} alt='banner' key={article?.banner[0]} />}
      </div>
      <div className={style.info}>
        <h2 className={style.title}>{article?.title}</h2>
        <h3 className={style.subtitle}>{article?.subTitle}</h3>
        <span>
          <svg className='icon' viewBox='0 0 1024 1024' version='1.1' xmlns='http://www.w3.org/2000/svg' p-id='2091' width='200' height='200'>
            <path
              d='M789.504 890.368H319.488c-18.432 0-33.28 14.848-33.28 33.28s14.848 33.28 33.28 33.28h470.016c18.432 0 33.28-14.848 33.28-33.28s-14.848-33.28-33.28-33.28z'
              p-id='2092'
              fill='#2c2c2c'></path>
            <path
              d='M731.648 392.192c68.096-118.272 79.36-283.136 79.872-289.792 1.024-12.288-5.632-24.576-16.384-30.72-10.752-6.144-24.064-6.144-34.816 0.512-24.576 15.872-241.152 156.16-287.744 235.52C404.48 422.4 237.056 728.576 235.52 731.648c-1.536 2.56-2.048 5.12-3.072 7.68L140.8 898.048c-9.216 15.872-3.584 36.352 12.288 45.568 5.12 3.072 10.752 4.608 16.384 4.608 11.264 0 22.528-6.144 28.672-16.896l93.696-161.792c58.368-39.936 371.2-258.048 439.808-377.344z m-201.728-51.2c23.04-39.424 122.368-115.2 206.336-173.056-9.216 54.272-27.648 130.56-61.952 190.976-39.936 68.608-190.976 189.952-310.272 278.016 54.272-98.816 126.464-229.376 165.888-295.936z'
              p-id='2093'
              fill='#2c2c2c'></path>
          </svg>
          {article?.author.nickname}
        </span>
        <span>
          <svg className='icon' viewBox='0 0 1280 1024' version='1.1' xmlns='http://www.w3.org/2000/svg' p-id='5272' width='200' height='200'>
            <path
              d='M1251.882 587.646L843.646 995.882c-37.492 37.492-98.276 37.49-135.764 0l-0.72-0.72L1184 519.764 662.794 0h97.442a96 96 0 0 1 67.882 28.118l423.764 423.764c37.49 37.49 37.49 98.274 0 135.764z m-256 0L587.646 995.882C568.902 1014.628 544.332 1024 519.764 1024c-24.568 0-49.138-9.372-67.882-28.118L28.118 572.118A96 96 0 0 1 0 504.236V96C0 42.98 42.98 0 96 0h408.236a95.996 95.996 0 0 1 67.882 28.118l423.764 423.764c37.49 37.49 37.49 98.274 0 135.764zM928 519.764L504.236 96H96v408.236l423.772 423.756L928 519.764zM288 192c-53.02 0-96 42.98-96 96s42.98 96 96 96 96-42.98 96-96-42.98-96-96-96z'
              p-id='5273'
              fill='#2c2c2c'></path>
          </svg>
          {article?.tags.join(', ')}
        </span>
        <span>
          <svg className='icon' viewBox='0 0 1024 1024' version='1.1' xmlns='http://www.w3.org/2000/svg' p-id='6242' width='200' height='200'>
            <path
              d='M976.474353 571.934118c-8.402824 10.24-209.588706 249.946353-464.474353 249.946353S55.928471 582.174118 47.495529 571.934118l-17.468235-21.112471 17.468235-21.142588c8.432941-10.209882 209.588706-249.916235 464.504471-249.916235s456.071529 239.706353 464.474353 249.916235l17.468235 21.142588-17.468235 21.112471zM512 344.816941c-184.470588 0-343.943529 149.564235-397.492706 205.974588 53.669647 56.350118 213.443765 206.034824 397.492706 206.034824 184.470588 0 343.943529-149.564235 397.492706-205.974588-53.669647-56.380235-213.443765-206.034824-397.492706-206.034824z m0 346.955294c-75.203765 0-136.372706-63.247059-136.372706-140.950588s61.168941-140.950588 136.372706-140.950588 136.372706 63.247059 136.372706 140.950588-61.199059 140.950588-136.372706 140.950588z m0-216.847059c-40.478118 0-73.426824 34.063059-73.426824 75.926589s32.948706 75.896471 73.426824 75.89647 73.426824-34.032941 73.426824-75.89647-32.948706-75.926588-73.426824-75.926589z'
              p-id='6243'
              fill='#2c2c2c'></path>
          </svg>
          {article?.preview}
        </span>
        <span>
          <svg className='icon' viewBox='0 0 1024 1024' version='1.1' xmlns='http://www.w3.org/2000/svg' p-id='7149' width='200' height='200'>
            <path
              d='M488 0.6c-73.4 4.2-141.5 22.1-204.8 53.8C163.4 114.4 71.1 219.7 28 345.5 14.5 385 7.1 419.3 2.4 463.5c-2.4 22.3-2.4 74.7 0 97 9.3 87.2 35.8 162.5 82 232.5 20.3 30.8 38.4 52.9 65.6 80 41.4 41.5 82.9 71.5 134 96.9 59 29.3 115.7 45.3 185.5 52.2 16.8 1.7 71.8 1.7 89 0.1 110.2-10.7 206.7-51 289.5-121.1 31.3-26.5 73.6-73.3 81.2-89.9 8.3-18.3 4.7-39.7-9.3-54.7-6.5-6.9-16.2-12.7-24.5-14.5-8-1.8-20.4-1.4-27.5 1-12.5 4.2-16.6 7.9-38.1 33.9-55.8 67.6-137.1 117-225.2 136.7-31.5 7-57.4 9.8-91.1 9.8-35.4-0.1-64.7-3.6-98-11.9C319.3 887.7 235.8 831 178 750c-40.1-56.2-64.7-120.6-73.7-193-2.5-20.5-2.5-69.5 0-90 3.9-31.2 9.6-56.7 19.2-85.5 46.9-141 167-245.8 314-273.9 19.9-3.8 35.6-5.5 64-7 28.7-1.5 31.4-2.1 42.2-9.2 20.2-13.5 27.2-41.8 15.9-64.3-3.2-6.2-11.3-15.1-17.4-19-9.4-6-15.1-7.3-32.2-7.6-8.5-0.1-18.4-0.1-22 0.1zM670.3 35.5c-11.8 3.2-22.7 10.9-29.1 20.5-11.2 16.7-11.2 39.3-0.1 55.9 7 10.5 11.9 13.9 34.4 23.6 24 10.4 39.8 19 64 35.1 24 15.9 41.2 30 62.5 51.3 32 32 54.9 63.1 74.7 101.8 23.9 46.3 37.4 90.6 44 144.3 2.5 20.4 2.5 68.6 0 89-2.5 20-5.1 34.6-9.8 54.1-2.1 9.1-3.9 18.4-3.9 20.6 0 12.8 5.7 26.6 14.6 35.5 20.5 20.4 52.8 20.1 72.2-0.6 7.9-8.5 11.2-15.7 15.5-34.1 22.8-95.9 18.8-188.6-11.8-281-24.9-75-65.2-140.9-120.3-196.9-34.5-35-68.2-61.1-109.7-85.1-23.7-13.7-63.4-32-74.3-34.4-7-1.5-16.5-1.3-22.9 0.4z'
              p-id='7150'
              fill='#2c2c2c'></path>
            <path
              d='M501 245c-15.7 2.8-29.3 12.7-36.4 26.7-5.9 11.7-5.6 3.9-5.6 160.3 0 157-0.3 149.1 5.8 160.4 3.6 6.7 14.5 17.7 20.8 20.9 11.6 5.9 7.5 5.7 123.6 5.7 92.3 0 107.2-0.2 112.3-1.5 22.1-5.8 37.5-25.7 37.5-48.5 0-13.8-5.3-26.1-15.4-35.8-3.4-3.3-8.5-7.1-11.4-8.6-11.2-5.7-9.9-5.6-94.4-5.6H560V405.2c0-123.8 0.1-121.4-5.7-133.2-3.6-7.5-15.1-18.9-22.6-22.4-10.2-4.8-20.7-6.3-30.7-4.6z'
              p-id='7151'
              fill='#2c2c2c'></path>
          </svg>
          {moment(article?.ctime).format('LLL')}
        </span>
        <hr style={{ background: '#333333' }} />
      </div>
      <Viewer value={article?.content} plugins={plugins} />
      {article && store.user._id === article.author._id && <ToolBtn type='edit' onClick={handleEdit} />}
      <Footer></Footer>
    </Fragment>
  );
}
